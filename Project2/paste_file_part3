#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/sched.h>
#include <linux/sched/signal.h>
#include <linux/pid.h>

//in the Linux kernel mod book
static int pid = 1;  // Default PID
module_param(pid, int, 0444);  // Accepts a PID as a module parameter
MODULE_PARM_DESC(pid, "The Process ID to look up");


static int __init print_info_mod(void) {
    struct task_struct *task;

    // Find the process by PID
    task = pid_task(find_vpid(pid), PIDTYPE_PID);
    
    // Print error if PID is not found
    if (!task) {
        printk(KERN_ERR "Could not find PID %d\n", pid);
        return -ESRCH;
    }

    // Traverse process tree up to init (PID 1)
    while (task != 1) {
        printk("Process: %s - PID [%d] - State: %ld", 
               task->comm, task->pid, task->state);
        
        task = task->parent;  // Move to parent process
    }

    return 0;
}

// Cleanup function when module is removed
static void __exit cleanup_info_mod(void) {
    printk("print_info_mod module removed.\n");
}

module_init(print_info_mod);
module_exit(cleanup_info_mod);
